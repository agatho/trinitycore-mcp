api:
  class: Garrison
  method: SaveToDB
  signature: void Garrison::SaveToDB(int trans)
documentation:
  brief: Saves the garrison data to the database with optional transaction support.
  description: The SaveToDB method persists all current garrison-related data to the
    database. It is typically invoked when changes to the garrison's state need to
    be committed, such as when buildings are constructed, upgraded, or when resources
    are allocated. The method accepts an optional transaction parameter that allows
    for batch operations within a single database transaction. This ensures data consistency
    and atomicity of garrison modifications across multiple related tables.
  parameters:
  - name: trans
    description: Optional database transaction handle. If provided, the save operation
      will be executed within the context of this transaction. If null or not specified,
      a new transaction is created internally for the save operation.
  returns: None. The method performs the save operation and does not return any value.
  examples:
  - title: Basic Usage
    code: 'Garrison* garrison = player->GetGarrison();

      garrison->SaveToDB();'
    language: cpp
  - title: Usage with Transaction
    code: 'TransactionPtr trans = new Transaction();

      Garrison* garrison = player->GetGarrison();

      garrison->SaveToDB(trans);

      // Additional operations can be added to the transaction

      trans->Execute();'
    language: cpp
  notes: This method should only be called when the garrison data has been modified
    and needs persistence. It is recommended to batch multiple modifications together
    using a transaction for performance optimization. The method internally handles
    serialization of garrison components such as buildings, plots, and resources.
  warnings: Calling this method without proper transaction handling may lead to partial
    saves if an error occurs mid-operation. Always ensure that the player's session
    or game state is properly synchronized with database changes after calling SaveToDB.
  related:
  - Garrison::LoadFromDB
  - Garrison::Initialize
  - Garrison::Update
metadata:
  confidence: 0.9
  generated_at: '2025-11-02T07:11:20.083609'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
