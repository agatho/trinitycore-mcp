api:
  class: UnitData
  method: AppendAllowedFieldsMaskForFlag
  signature: void UnitData::AppendAllowedFieldsMaskForFlag(int & allowedMaskForTarget,
    int fieldVisibilityFlags)
documentation:
  brief: Appends field visibility flags to an allowed mask for a target unit.
  description: The AppendAllowedFieldsMaskForFlag method modifies an existing allowed
    field mask by incorporating specified field visibility flags. This is typically
    used in World of Warcraft's TrinityCore server to determine which data fields
    of a Unit (such as a player or creature) should be visible to another unit during
    network synchronization. The method adjusts the mask based on the provided visibility
    flags, ensuring that only appropriate fields are exposed to the target unit according
    to game rules and permissions.
  parameters:
  - name: allowedMaskForTarget
    description: Reference to an integer that holds the current allowed field mask
      for the target unit. This mask will be modified in-place by appending new visibility
      flags.
  - name: fieldVisibilityFlags
    description: Integer representing the field visibility flags to append to the
      allowed mask. These flags define which data fields are accessible to the target
      unit based on visibility rules.
  returns: null
  examples:
  - title: Basic Usage Example
    code: 'int mask = 0;

      UnitData* unitData = player->GetUnitData();

      unitData->AppendAllowedFieldsMaskForFlag(mask, VISIBILITY_FLAG_VISIBLE);

      // mask now contains the updated allowed fields mask'
    language: cpp
  - title: Advanced Usage with Multiple Flags
    code: 'int mask = 0;

      UnitData* unitData = creature->GetUnitData();

      unitData->AppendAllowedFieldsMaskForFlag(mask, VISIBILITY_FLAG_VISIBLE | VISIBILITY_FLAG_COMBAT);
      // Combine multiple visibility flags

      // mask now includes both visible and combat-related field permissions'
    language: cpp
  notes: This method is part of the internal networking and data synchronization system
    in TrinityCore. It's commonly invoked when preparing update packets for units
    to ensure that only authorized fields are sent over the network. The mask manipulation
    is crucial for maintaining performance and preventing information leakage.
  warnings: Modifying field masks incorrectly can lead to data visibility issues or
    security vulnerabilities. Ensure that fieldVisibilityFlags are valid and properly
    defined according to the game's visibility system before calling this method.
  related:
  - GetAllowedFieldsMaskForTarget
  - SetAllowedFieldsMaskForTarget
  - UpdateFieldVisibility
metadata:
  confidence: 0.9
  generated_at: '2025-11-07T17:56:09.507101'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
