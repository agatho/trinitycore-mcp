api:
  class: VisualAnim
  method: WriteUpdate
  signature: void VisualAnim::WriteUpdate(ByteBuffer & data, bool ignoreChangesMask,
    const AreaTrigger * owner, const Player * receiver) const
documentation:
  brief: Writes visual animation update data to a ByteBuffer for transmission to a
    player.
  description: The WriteUpdate method serializes the visual animation's current state
    into a ByteBuffer, which is then sent to a specific player client. This method
    handles the construction of the update packet that represents the visual animation's
    properties, including its ID, sequence, and any relevant flags. It takes into
    account whether changes should be ignored based on the ignoreChangesMask parameter
    and uses the provided owner AreaTrigger and receiver Player to determine proper
    serialization context. The method is typically invoked during packet sending operations
    when updating clients about visual animations in the game world.
  parameters:
  - name: data
    description: Reference to a ByteBuffer where the serialized update data will be
      written. This buffer is used to construct the network packet sent to the client.
  - name: ignoreChangesMask
    description: Boolean flag indicating whether to ignore the changes mask when writing
      the update. If true, all fields are written regardless of change status; if
      false, only changed fields are serialized.
  - name: owner
    description: Pointer to the AreaTrigger that owns this visual animation. Used
      to determine context for serialization and positioning information.
  - name: receiver
    description: Pointer to the Player who will receive this update packet. The method
      may use this to apply player-specific filtering or adjustments.
  returns: null
  examples:
  - title: Basic Usage in Update Packet Construction
    code: 'ByteBuffer data;

      VisualAnim anim;

      AreaTrigger* trigger = ...;

      Player* player = ...;

      anim.WriteUpdate(data, false, trigger, player);

      // Send ''data'' to player via WorldPacket'
    language: cpp
  - title: Ignoring Changes Mask for Full Update
    code: 'ByteBuffer data;

      VisualAnim anim;

      AreaTrigger* trigger = ...;

      Player* player = ...;

      anim.WriteUpdate(data, true, trigger, player);

      // Full serialization regardless of change status'
    language: cpp
  notes: This method is part of the TrinityCore's packet update system and should
    only be called during active network communication phases. The method assumes
    that the provided parameters are valid and not null. It does not perform any validation
    on the inputs beyond basic null checks.
  warnings: Calling this method with invalid or null pointers for owner or receiver
    may result in undefined behavior. Ensure that the ByteBuffer is properly initialized
    before calling this method to avoid memory corruption issues.
  related:
  - VisualAnim::BuildUpdateData
  - VisualAnim::SendUpdate
  - VisualAnim::GetId
  - VisualAnim::GetSequence
metadata:
  confidence: 0.9
  generated_at: '2025-11-07T17:27:50.299615'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
