api:
  class: Unit
  method: CalculateAOEAvoidance
  signature: int32 Unit::CalculateAOEAvoidance(int32 damage, uint32 schoolMask, bool
    npcCaster) const
documentation:
  brief: Calculates the avoidance value for area-of-effect damage
  description: This method computes the total avoidance value that a unit applies
    against area-of-effect damage, considering both damage amount and school mask.
    It is used in conjunction with the CalculateAOEHitResult method to determine how
    much damage will be mitigated by the target's avoidance. The method accounts for
    various factors including NPC caster status, which affects how the avoidance is
    calculated for different types of attacks.
  parameters:
  - name: damage
    description: The amount of damage to be calculated for avoidance. This value represents
      the base damage before any modifiers or reductions.
  - name: schoolMask
    description: The school mask representing the type of damage being calculated.
      This determines which damage types are considered in the calculation, such as
      physical, holy, fire, etc.
  - name: npcCaster
    description: Boolean flag indicating whether the caster is an NPC or player. When
      true, this affects how the avoidance calculation is handled for different types
      of attacks.
  returns: Represents the calculated avoidance value that can be applied to reduce
    incoming damage. A negative value indicates that no avoidance was applied and
    the full damage will occur, while positive values indicate that some damage was
    mitigated by the target's avoidance.
  examples:
  - title: Basic usage example
    code: int32 avoidance = unit->CalculateAOEAvoidance(100, SPELL_SCHOOL_MASK_FIRE,
      false);
    language: cpp
  - title: Advanced usage example with NPC caster
    code: 'int32 avoidance = unit->CalculateAOEAvoidance(damage, schoolMask, true);

      // This would be used in an NPC''s AOE attack calculation

      // where the damage is reduced by the target''s avoidance'
    language: cpp
  notes: This method is typically used during AOE spell calculations to determine
    how much damage will be mitigated by the target's avoidance. It should be called
    after calculating the hit result but before applying final damage. The method
    may return 0 if no avoidance exists or if the unit has no avoidance capabilities.
  warnings: The method assumes that the unit is capable of avoiding AOE attacks, which
    may not always be true for all units. Care must be taken when using this method
    in conjunction with other damage calculation methods to ensure proper sequence
    of operations.
  related:
  - CalculateAOEHitResult
  - CalculateDamage
  - GetUnitAvoidance
metadata:
  confidence: 0.85
  generated_at: '2025-10-30T21:23:07.967708'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
