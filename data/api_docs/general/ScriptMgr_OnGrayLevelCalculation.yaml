api:
  class: ScriptMgr
  method: OnGrayLevelCalculation
  signature: void ScriptMgr::OnGrayLevelCalculation(uint8 & grayLevel, uint8 playerLevel)
documentation:
  brief: Calculates the gray level threshold for player versus player combat based
    on player level.
  description: The OnGrayLevelCalculation method is a hook in the ScriptMgr class
    that allows custom scripts to modify or override the default gray level calculation
    logic used in World of Warcraft's Player versus Player (PvP) system. This gray
    level determines the minimum level difference at which players can engage in PvP
    combat without becoming flagged as hostile. The method receives a reference to
    the grayLevel variable and the player's current level, allowing scripts to adjust
    the gray level dynamically based on custom game rules or conditions. It is typically
    invoked during player login or when level changes occur, and modifications made
    to the grayLevel parameter directly affect the player's PvP behavior.
  parameters:
  - name: grayLevel
    description: Reference to the calculated gray level value that determines the
      minimum level difference for PvP combat. This value is modified in-place by
      scripts to customize PvP mechanics.
  - name: playerLevel
    description: The current level of the player for whom the gray level is being
      calculated. Used as input to determine appropriate gray level adjustments.
  returns: null
  examples:
  - title: Basic Gray Level Modification
    code: "void MyScript::OnGrayLevelCalculation(uint8& grayLevel, uint8 playerLevel)\n\
      {\n    // Set gray level to 5 levels below player's level\n    grayLevel = playerLevel\
      \ > 5 ? playerLevel - 5 : 0;\n}"
    language: cpp
  - title: Conditional Gray Level Adjustment
    code: "void MyScript::OnGrayLevelCalculation(uint8& grayLevel, uint8 playerLevel)\n\
      {\n    // For players above level 60, reduce gray level by 2\n    if (playerLevel\
      \ > 60)\n        grayLevel = std::max(0, static_cast<int>(grayLevel) - 2);\n\
      }"
    language: cpp
  notes: This method is called during critical player state transitions such as login
    or level-up events. Scripts should ensure that the grayLevel value remains within
    valid bounds (typically 0-80 for standard WoW levels). The modification of grayLevel
    affects PvP flagging behavior and should be used carefully to maintain game balance.
  warnings: Modifying grayLevel can significantly impact player PvP experience and
    game balance. Ensure that changes do not create unfair advantages or unintended
    consequences in combat mechanics. Avoid setting grayLevel to negative values as
    it may cause undefined behavior.
  related:
  - OnPlayerLevelUp
  - OnPlayerLogin
  - OnPvPCalculateCap
metadata:
  confidence: 0.9
  generated_at: '2025-11-01T22:47:06.679226'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
