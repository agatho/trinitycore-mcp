api:
  class: SmartAI
  method: DamageTaken
  signature: void SmartAI::DamageTaken(Unit * doneBy, uint32 & damage, int param2,
    const SpellInfo * param3)
documentation:
  brief: Handles damage received by the creature and triggers SmartAI event logic
  description: The DamageTaken method is a callback function in SmartAI that gets
    invoked whenever the creature receives damage from another unit. This method allows
    the AI to respond dynamically to incoming attacks, enabling complex behaviors
    such as triggering events, casting spells, or changing states based on the damage
    amount or source. It serves as a core part of the event-driven AI system used
    in TrinityCore for intelligent creature behavior.
  parameters:
  - name: doneBy
    description: Pointer to the Unit that inflicted the damage. Can be NULL if the
      damage source is not a unit (e.g., environment effects).
  - name: damage
    description: Reference to the damage amount dealt. This value can be modified
      by the AI logic to adjust the actual damage taken.
  - name: param2
    description: Additional parameter that may contain contextual information about
      the damage event, such as spell ID or effect type.
  - name: param3
    description: Pointer to the SpellInfo structure describing the spell that caused
      the damage, if applicable. May be NULL for non-spell damage sources.
  returns: null
  examples:
  - title: Basic Damage Reaction
    code: "void SmartAI::DamageTaken(Unit* doneBy, uint32& damage, int param2, const\
      \ SpellInfo* param3)\n{\n    if (damage > 100)\n    {\n        // Trigger a\
      \ spell when taking high damage\n        DoCast(doneBy, SPELL_REACTIVE_DAMAGE);\n\
      \    }\n}"
    language: cpp
  - title: Modify Damage Based on Source
    code: "void SmartAI::DamageTaken(Unit* doneBy, uint32& damage, int param2, const\
      \ SpellInfo* param3)\n{\n    if (doneBy && doneBy->IsPlayer())\n    {\n    \
      \    // Reduce damage from players by 50%\n        damage /= 2;\n    }\n}"
    language: cpp
  notes: This method is part of the SmartAI event system and is automatically called
    by the core when a creature takes damage. The 'damage' parameter is passed by
    reference, allowing modification of the actual damage amount before it's applied
    to the creature. Ensure that any modifications to damage do not cause negative
    values or overflow issues.
  warnings: Modifying the damage value directly can affect combat balance and should
    be done carefully. Be cautious when accessing 'doneBy' as it may be NULL, especially
    for environmental or non-unit-based damage sources.
  related:
  - SmartAI::UpdateAI
  - SmartAI::EnterCombat
  - SmartAI::JustDied
metadata:
  confidence: 0.95
  generated_at: '2025-11-06T02:57:03.988703'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
