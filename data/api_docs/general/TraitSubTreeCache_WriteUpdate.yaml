api:
  class: TraitSubTreeCache
  method: WriteUpdate
  signature: void TraitSubTreeCache::WriteUpdate(ByteBuffer & data, bool ignoreChangesMask,
    const Player * owner, const Player * receiver) const
documentation:
  brief: Writes trait subtree update data to a ByteBuffer for transmission to a player.
  description: The WriteUpdate method serializes the trait subtree cache data into
    a ByteBuffer format suitable for network transmission. This method is typically
    used when sending updates about trait trees and their states to players in the
    game world. The serialization process can optionally ignore changes masks, allowing
    for full data synchronization regardless of modification flags. The method requires
    both an owner and receiver player reference to determine appropriate data filtering
    and formatting based on player-specific trait visibility rules.
  parameters:
  - name: data
    description: Reference to a ByteBuffer where the serialized trait subtree update
      data will be written. This buffer is typically used for network packet construction.
  - name: ignoreChangesMask
    description: Boolean flag indicating whether to ignore the changes mask when writing
      updates. If true, all trait data is written regardless of modification status;
      if false, only changed data is included.
  - name: owner
    description: Pointer to the Player object that owns the trait subtree cache. Used
      to determine what data should be included in the update based on ownership and
      visibility rules.
  - name: receiver
    description: Pointer to the Player object who will receive this update. Used to
      apply appropriate filtering and formatting based on the receiver's relationship
      to the trait data.
  returns: null
  examples:
  - title: Basic usage for sending trait subtree update
    code: 'ByteBuffer data;

      Player* owner = ...; // Get player who owns the traits

      Player* receiver = ...; // Get target player

      TraitSubTreeCache cache;

      cache.WriteUpdate(data, false, owner, receiver);

      // Send data through network layer'
    language: cpp
  - title: Force full update ignoring changes mask
    code: 'ByteBuffer data;

      Player* owner = ...;

      Player* receiver = ...;

      TraitSubTreeCache cache;

      cache.WriteUpdate(data, true, owner, receiver);

      // Send complete trait data regardless of modification status'
    language: cpp
  notes: This method is primarily used in the context of World of Warcraft's trait
    system where players can unlock and modify various trait trees. The implementation
    likely handles compression or delta updates based on the ignoreChangesMask parameter.
    Performance considerations include the size of the trait data being serialized,
    which may vary significantly depending on the number of traits and their complexity.
  warnings: The method assumes valid Player pointers are provided; passing null pointers
    will likely cause crashes or undefined behavior. The ByteBuffer must be properly
    initialized before calling this method as it will append data to existing content
    rather than replacing it.
  related:
  - GetTraitSubTree
  - UpdateTraitSubTree
  - IsTraitSubTreeDirty
metadata:
  confidence: 0.85
  generated_at: '2025-11-07T18:04:20.066513'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
