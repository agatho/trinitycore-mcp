api:
  class: Battlefield
  method: EndBattle
  signature: void Battlefield::EndBattle(bool endByTimer)
documentation:
  brief: Ends the battlefield battle and handles cleanup and reward distribution.
  description: The EndBattle method is responsible for concluding a battlefield match,
    performing necessary cleanup operations, and distributing rewards to participating
    players. It manages the transition from active combat to post-battle state, ensuring
    all battlefield-related systems are properly reset. The method can be triggered
    either by natural battle completion or by a timer expiration, as indicated by
    the endByTimer parameter. This function is typically called internally by the
    battlefield system when victory conditions are met or when the battle duration
    has elapsed.
  parameters:
  - name: endByTimer
    description: Boolean flag indicating whether the battle ended due to a timer expiration
      (true) or natural completion (false). This affects reward distribution and victory
      conditions.
  returns: void
  examples:
  - title: Ending Battlefield Battle by Timer Expiration
    code: "Battlefield* bf = sBattlefieldMgr->GetBattlefieldByInstanceId(12345);\n\
      if (bf)\n{\n    bf->EndBattle(true);\n}"
    language: cpp
  - title: Ending Battlefield Battle Due to Victory
    code: "Battlefield* bf = sBattlefieldMgr->GetBattlefieldByInstanceId(12345);\n\
      if (bf && bf->IsBattleFinished())\n{\n    bf->EndBattle(false);\n}"
    language: cpp
  notes: This method should only be called when the battlefield is in an active state.
    It performs cleanup operations including removing players from the battlefield,
    updating player statistics, and sending end-of-battle messages to clients. The
    method assumes that all necessary victory conditions have already been evaluated
    before calling.
  warnings: Calling this method without proper preconditions may result in undefined
    behavior or client-side errors. Ensure that the battlefield is actually in a state
    where it can be ended before invoking this function. Do not call this method multiple
    times on the same battlefield instance.
  related:
  - Battlefield::StartBattle
  - Battlefield::IsBattleFinished
  - Battlefield::Update
  - Battlefield::PlayerEnter
metadata:
  confidence: 0.9
  generated_at: '2025-11-06T20:44:08.277560'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
