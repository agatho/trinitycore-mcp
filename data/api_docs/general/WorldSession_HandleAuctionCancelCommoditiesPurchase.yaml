api:
  class: WorldSession
  method: HandleAuctionCancelCommoditiesPurchase
  signature: void WorldSession::HandleAuctionCancelCommoditiesPurchase(WorldPackets::AuctionHouse::AuctionCancelCommoditiesPurchase
    & cancelCommoditiesPurchase)
documentation:
  brief: Cancels a commodities purchase from the auction house.
  description: This method handles the client request to cancel a previously made
    commodities purchase transaction in the auction house. It processes the cancellation
    by removing the associated auction item from the player's inventory or pending
    transactions, and refunds any applicable currency or items. The method is part
    of the auction house system's commodity purchasing flow, where players can buy
    commodities using various currencies such as gold or special tokens. This function
    ensures proper cleanup of auction data and maintains consistency in the game economy.
  parameters:
  - name: cancelCommoditiesPurchase
    description: A packet containing the details of the commodities purchase to be
      canceled, including the auction item ID and transaction information.
  returns: null
  examples:
  - title: Canceling a commodities purchase
    code: 'WorldPackets::AuctionHouse::AuctionCancelCommoditiesPurchase cancelPacket;

      cancelPacket.AuctionId = 12345;

      worldSession->HandleAuctionCancelCommoditiesPurchase(cancelPacket);'
    language: cpp
  notes: This method is typically invoked when a player clicks the 'cancel' button
    on an active commodities purchase in the auction house interface. The implementation
    should validate that the auction item belongs to the current session's player
    and that the transaction state allows for cancellation.
  warnings: Improper handling of this method could lead to currency or item desync
    between client and server, potentially allowing exploits. Ensure proper validation
    of auction ownership and transaction states before processing the cancellation.
  related:
  - HandleAuctionPlaceBid
  - HandleAuctionBuyItem
  - HandleAuctionSellItem
metadata:
  confidence: 0.85
  generated_at: '2025-11-02T19:48:01.003882'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
