api:
  class: Unit
  method: MeleeDamageBonusTaken
  signature: int32 Unit::MeleeDamageBonusTaken(Unit * attacker, int32 pdamage, int
    attType, DamageEffectType damagetype, const SpellInfo * spellProto, int damageSchoolMask)
documentation:
  brief: Calculates melee damage reduction based on attacker's level and target's
    resistance.
  description: This method computes the total damage reduction applied to a melee
    attack, taking into account the attacker's level difference, target's resistance,
    and various modifiers. It is used in combat calculations to determine how much
    damage is actually dealt when a unit performs a melee attack against another unit.
    The method considers both physical and magical damage types, with different handling
    for each depending on the attack type and spell information provided.
  parameters:
  - name: attacker
    description: Pointer to the attacking unit that is performing the melee attack.
      This parameter determines the level difference used in damage calculation.
  - name: pdamage
    description: Base damage value being applied to the attack. This represents the
      raw damage amount before any modifiers or reductions are applied.
  - name: attType
    description: Attack type identifier (e.g., 0 for normal, 1 for special). This
      determines how the damage reduction is calculated and whether it applies to
      physical or magical damage types.
  - name: damagetype
    description: Damage effect type enum (e.g., DamageEffectType::DIRECT_DAMAGE).
      This specifies the type of damage being applied, affecting how resistance is
      handled.
  - name: spellProto
    description: Pointer to the spell information structure. This parameter determines
      whether the attack is physical or magical in nature, and affects how damage
      reduction is calculated.
  - name: damageSchoolMask
    description: Damage school mask indicating which damage types are being considered.
      This helps determine the appropriate resistance values to use for calculation.
  returns: Returns an integer value representing the total damage reduction applied
    to the melee attack, which can be negative if damage is increased due to over-level
    differences or positive if damage is reduced by resistance.
  examples:
  - title: Basic Usage Example
    code: 'int32 damage = unit->MeleeDamageBonusTaken(attacker, pdamage, 0, DIRECT_DAMAGE,
      spellInfo, 1);

      // This calculates the damage reduction for a normal melee attack'
    language: cpp
  - title: Advanced Usage Example
    code: 'int32 damage = unit->MeleeDamageBonusTaken(attacker, pdamage, 1, SPELL_DAMAGE,
      spellInfo, 0);

      // This calculates the damage reduction for a special attack with magical damage
      type'
    language: cpp
  notes: This method is used internally in combat calculations and requires accurate
    level difference handling. Performance considerations include avoiding unnecessary
    calls when damage is not being calculated. Thread safety depends on the unit's
    state; if unit is not properly initialized, this method may cause issues.
  warnings: This method should only be called when both attacker and target are valid
    units. Calling with null pointers can lead to crashes or undefined behavior. The
    method assumes proper initialization of spell information and damage types.
  related:
  - MeleeDamageBonus
  - DamageBonus
  - SpellDamageBonus
  - CalculateDamageReduction
metadata:
  confidence: 0.95
  generated_at: '2025-10-30T20:58:13.858260'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
