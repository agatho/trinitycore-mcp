api:
  class: WorldSession
  method: HandleSetDungeonDifficultyOpcode
  signature: void WorldSession::HandleSetDungeonDifficultyOpcode(WorldPackets::Misc::SetDungeonDifficulty
    & setDungeonDifficulty)
documentation:
  brief: Updates the dungeon difficulty setting for the player's current instance.
  description: The HandleSetDungeonDifficultyOpcode method processes a client request
    to change the difficulty level of the current dungeon or raid instance. This method
    is invoked when players select a new difficulty option from the game interface,
    such as switching between Normal, Heroic, and Mythic modes for dungeons. The function
    validates the requested difficulty setting against the player's permissions and
    the instance's allowed difficulties, then applies the change to the player's session
    data. It ensures that only valid difficulty levels are set and that the player
    has appropriate access rights to the selected mode.
  parameters:
  - name: setDungeonDifficulty
    description: A packet containing the requested dungeon difficulty setting from
      the client. This parameter includes information about which difficulty level
      the player wants to switch to, typically represented as an integer value corresponding
      to Normal (1), Heroic (2), or Mythic (3) modes.
  returns: null
  examples:
  - title: Setting Dungeon Difficulty
    code: "void WorldSession::HandleSetDungeonDifficultyOpcode(WorldPackets::Misc::SetDungeonDifficulty&\
      \ setDungeonDifficulty)\n{\n    // Validate difficulty setting\n    if (setDungeonDifficulty.DifficultyID\
      \ < 1 || setDungeonDifficulty.DifficultyID > 3)\n        return;\n    \n   \
      \ // Apply the new difficulty to player's instance\n    _player->SetDungeonDifficulty(setDungeonDifficulty.DifficultyID);\n\
      \    \n    // Send confirmation packet back to client\n    WorldPackets::Misc::DungeonDifficulty\
      \ dungeonDiff;\n    dungeonDiff.DifficultyID = setDungeonDifficulty.DifficultyID;\n\
      \    SendPacket(dungeonDiff.Write());\n}"
    language: cpp
  notes: This method is part of the core instance management system in TrinityCore.
    It should only be called when a player is inside an appropriate dungeon or raid
    instance, and the difficulty change must be validated against both server configuration
    and player permissions. The actual difficulty application may involve updating
    multiple internal data structures including instance save data and character-specific
    settings.
  warnings: Improper handling of this method can lead to players being unable to enter
    instances with incorrect difficulty settings. Ensure that all difficulty changes
    are properly validated before applying them, as invalid values could cause crashes
    or unexpected behavior in the instance system.
  related:
  - HandleDungeonDifficultyOpcode
  - SetDungeonDifficulty
  - GetDungeonDifficulty
metadata:
  confidence: 0.9
  generated_at: '2025-11-02T19:20:32.505315'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
