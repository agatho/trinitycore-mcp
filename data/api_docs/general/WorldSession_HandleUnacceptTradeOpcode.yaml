api:
  class: WorldSession
  method: HandleUnacceptTradeOpcode
  signature: void WorldSession::HandleUnacceptTradeOpcode(WorldPackets::Trade::UnacceptTrade
    & unacceptTrade)
documentation:
  brief: Handles the client's request to cancel a pending trade agreement
  description: The HandleUnacceptTradeOpcode method processes the player's intent
    to withdraw their trade acceptance during an active trade session. When invoked,
    this method terminates the current trade window and resets the trade state for
    both players involved. The method ensures that any items or currency previously
    offered in the trade are returned to their respective owners, and the trade confirmation
    status is cleared. This function typically executes when a player clicks the 'Unaccept'
    button in the trade interface, signaling they no longer wish to proceed with the
    proposed trade.
  parameters:
  - name: unacceptTrade
    description: A packet object containing the trade unacceptance data from the client.
      This parameter includes information about which trade session is being canceled
      and ensures proper synchronization between client and server state.
  returns: null
  examples:
  - title: Basic usage in trade handling
    code: "void WorldSession::HandleUnacceptTradeOpcode(WorldPackets::Trade::UnacceptTrade&\
      \ unacceptTrade)\n{\n    if (Player* player = GetPlayer())\n    {\n        TradeData*\
      \ trade = player->GetTradeData();\n        if (trade)\n        {\n         \
      \   trade->Reset();\n            player->SendTradeStatus(TRADE_STATUS_CANCELLED);\n\
      \        }\n    }\n}"
    language: cpp
  notes: This method should be called only when a valid trade session exists. It assumes
    that the trade data has already been validated and initialized by previous trade-related
    operations. The method does not perform any additional validation beyond ensuring
    the trade state is properly reset.
  warnings: null
  related:
  - HandleInitiateTradeOpcode
  - HandleAcceptTradeOpcode
  - HandleCancelTradeOpcode
metadata:
  confidence: 0.95
  generated_at: '2025-11-04T20:08:18.706070'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
