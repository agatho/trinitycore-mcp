api:
  class: WorldSession
  method: HandleLootOpcode
  signature: void WorldSession::HandleLootOpcode(WorldPackets::Loot::LootUnit & packet)
documentation:
  brief: Processes a loot request from a player, handling the distribution of items
    from a looted corpse or container.
  description: The HandleLootOpcode method is responsible for processing incoming
    loot requests from players in World of Warcraft. When a player interacts with
    a creature or container to loot items, this method is invoked to manage the loot
    distribution process. It validates the player's ability to loot the target, checks
    for valid loot sources, and ensures proper item distribution according to the
    game's loot rules including group looting, free-for-all, and master loot systems.
    The method also handles updating the loot state and sending appropriate responses
    back to the client.
  parameters:
  - name: packet
    description: A WorldPackets::Loot::LootUnit packet containing information about
      the loot request including the target unit's GUID, loot mode, and other relevant
      data for processing the loot operation.
  returns: null
  examples:
  - title: Basic loot request handling
    code: "void WorldSession::HandleLootOpcode(WorldPackets::Loot::LootUnit& packet)\n\
      {\n    // Validate player is in a valid state to loot\n    if (!GetPlayer()\
      \ || !GetPlayer()->IsAlive())\n        return;\n    \n    // Process the loot\
      \ request\n    GetPlayer()->SendLoot(packet.GetGUID(), LOOT_MODE_DEFAULT);\n\
      }"
    language: cpp
  notes: This method is typically called from the main packet processing loop when
    a LOOT opcode is received. It performs several validation checks including player
    state, target validity, and loot permissions before proceeding with actual loot
    distribution. The method may trigger additional network packets to be sent back
    to the client for loot updates.
  warnings: Improper handling of this method can lead to loot exploits or desynchronization
    between server and client. Developers should ensure proper validation of all inputs
    and maintain strict adherence to game rules regarding loot distribution, especially
    in group scenarios where multiple players may have access to the same loot source.
  related:
  - SendLoot
  - HandleLootReleaseOpcode
  - HandleLootMoneyOpcode
metadata:
  confidence: 0.95
  generated_at: '2025-11-04T21:42:55.403001'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
