api:
  class: WorldSession
  method: HandleCancelAutoRepeatSpellOpcode
  signature: void WorldSession::HandleCancelAutoRepeatSpellOpcode(WorldPackets::Spells::CancelAutoRepeatSpell
    & cancelAutoRepeatSpell)
documentation:
  brief: Cancels the auto-repeat spell currently being cast by the player.
  description: The HandleCancelAutoRepeatSpellOpcode method processes incoming client
    packets to cancel auto-repeat spells that are currently active on the player.
    This typically occurs when a player manually interrupts or stops the automatic
    casting of spells like Auto Shot, Shoot, or other abilities that have an auto-repeat
    mechanic. The method validates the spell being canceled and ensures proper state
    management for the player's auto-repeat behavior. It is part of the core spell
    handling system in TrinityCore and directly interacts with the player's spell
    cast state.
  parameters:
  - name: cancelAutoRepeatSpell
    description: A reference to a WorldPackets::Spells::CancelAutoRepeatSpell packet
      containing information about which auto-repeat spell should be canceled.
  returns: null
  examples:
  - title: Basic usage in packet handling
    code: "void WorldSession::HandleCancelAutoRepeatSpellOpcode(WorldPackets::Spells::CancelAutoRepeatSpell&\
      \ cancelAutoRepeatSpell)\n{\n    Player* player = GetPlayer();\n    if (!player)\n\
      \        return;\n\n    // Cancel the auto-repeat spell\n    player->GetSpellHistory()->CancelSpellCooldown(cancelAutoRepeatSpell.SpellID);\n\
      }"
    language: cpp
  notes: This method is typically called from the main packet processing loop when
    a client sends a cancel auto-repeat spell opcode. It's important to note that
    this only cancels the auto-repeat behavior, not the initial cast of the spell
    itself. The method assumes proper validation has already been performed on the
    incoming packet.
  warnings: Improper handling of auto-repeat cancellation may lead to inconsistent
    spell states or client desynchronization. Ensure that all related spell cooldowns
    and state flags are properly managed after calling this function.
  related:
  - HandleSpellCastRequest
  - HandleCancelSpellCast
  - Player::GetSpellHistory
metadata:
  confidence: 0.95
  generated_at: '2025-11-02T19:43:57.446006'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
