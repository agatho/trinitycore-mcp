api:
  class: CombatAIIntegrator
  method: OnCombatEnd
  signature: void CombatAIIntegrator::OnCombatEnd()
documentation:
  brief: Handles cleanup and state reset when combat ends for an AI-integrated creature
  description: The OnCombatEnd method is invoked when a creature's combat state transitions
    from active to inactive. This method performs necessary cleanup operations such
    as resetting AI behavior flags, clearing threat lists, stopping ongoing attacks,
    and restoring the creature's default idle state. It ensures that the AI system
    properly resets its internal state to prevent stale data from affecting future
    encounters. The method is typically called by the core combat management system
    when all combat participants have been removed from combat or when a combat timer
    expires.
  parameters: []
  returns: null
  examples:
  - title: Basic usage in custom AI implementation
    code: "class MyCustomAI : public CombatAIIntegrator {\npublic:\n    void OnCombatEnd()\
      \ override {\n        // Perform custom cleanup\n        ResetSpecialAbilities();\n\
      \        CombatAIIntegrator::OnCombatEnd(); // Call base implementation\n  \
      \  }\n};"
    language: cpp
  - title: Integration with creature despawn handling
    code: "void Creature::HandleCombatEnd() {\n    if (IsInCombat()) {\n        CombatAIIntegrator::OnCombatEnd();\n\
      \        // Additional cleanup like removing combat buffs\n        RemoveAurasByType(SPELL_AURA_COMBAT)\n\
      \    }\n}"
    language: cpp
  notes: This method is automatically called by the TrinityCore framework during combat
    state transitions. Developers should not call this method directly unless implementing
    a custom AI system that requires explicit control over combat end events. The
    base implementation handles core cleanup operations, so any override should call
    the parent implementation to maintain proper behavior.
  warnings: Avoid calling OnCombatEnd() manually in most cases as it may lead to inconsistent
    AI states or memory leaks if cleanup operations are duplicated. Ensure that any
    custom overrides properly chain to the base implementation to prevent loss of
    core functionality.
  related:
  - OnCombatStart
  - UpdateAI
  - IsInCombat
metadata:
  confidence: 0.92
  generated_at: '2025-11-06T17:15:56.548237'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
