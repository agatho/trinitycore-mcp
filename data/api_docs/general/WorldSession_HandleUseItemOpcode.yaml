api:
  class: WorldSession
  method: HandleUseItemOpcode
  signature: void WorldSession::HandleUseItemOpcode(WorldPackets::Spells::UseItem
    & packet)
documentation:
  brief: Processes a client's request to use an item, validating and executing the
    item's effect.
  description: The HandleUseItemOpcode method is responsible for processing incoming
    packet data from the client when a player attempts to use an item. It validates
    whether the item can be used by the player, checks for proper targeting, and then
    triggers the appropriate item usage logic. This includes handling consumable items,
    quest items, and other usable objects within the game world. The method ensures
    that the player has the necessary permissions, cooldowns are respected, and any
    associated effects or spells are properly executed.
  parameters: []
  returns: null
  examples:
  - title: Basic Item Usage Handling
    code: "void WorldSession::HandleUseItemOpcode(WorldPackets::Spells::UseItem& packet)\n\
      {\n    // Validate item usage\n    if (!packet.ItemGUID)\n        return;\n\
      \    \n    // Process the item use logic\n    Player* player = GetPlayer();\n\
      \    Item* item = player->GetItemByGuid(packet.ItemGUID);\n    if (item && player->CanUseItem(item))\n\
      \    {\n        player->UseItem(item, packet.Target);\n    }\n}"
    language: cpp
  notes: This method is part of the core spell and item handling system in TrinityCore.
    It directly interacts with the player's inventory and target systems. The method
    should be called only when a valid UseItem packet is received from the client,
    and it assumes proper packet validation has already occurred.
  warnings: Improper handling of this method can lead to exploits such as item duplication
    or unauthorized usage. Always validate that the player has sufficient permissions
    and that items are not being used in invalid contexts (e.g., using a quest item
    outside of appropriate quest conditions).
  related:
  - Player::UseItem
  - Player::CanUseItem
  - WorldSession::HandleSpellClickOpcode
metadata:
  confidence: 0.9
  generated_at: '2025-11-04T20:04:54.707130'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
