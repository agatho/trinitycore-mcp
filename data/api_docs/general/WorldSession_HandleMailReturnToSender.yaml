api:
  class: WorldSession
  method: HandleMailReturnToSender
  signature: void WorldSession::HandleMailReturnToSender(WorldPackets::Mail::MailReturnToSender
    & returnToSender)
documentation:
  brief: Returns a mail item to the sender by marking it as returned and updating
    its status in the database.
  description: The HandleMailReturnToSender method processes a client request to return
    a mail item to its original sender. This action typically occurs when a player
    clicks the 'Return to Sender' button on a mail message that has not yet been claimed
    or opened. The method updates the mail's status in the database to indicate it
    has been returned, and sends an appropriate response packet back to the client.
    It ensures proper handling of mail items that are eligible for return, including
    checking item ownership and validity before performing the operation.
  parameters:
  - name: returnToSender
    description: A reference to a MailReturnToSender packet containing information
      about which mail item should be returned to the sender. This includes the mail
      ID and any relevant metadata needed to process the return request.
  returns: null
  examples:
  - title: Basic usage of HandleMailReturnToSender
    code: "void WorldSession::HandleMailReturnToSender(WorldPackets::Mail::MailReturnToSender&\
      \ returnToSender)\n{\n    // Process the mail return request\n    if (returnToSender.MailID)\n\
      \    {\n        // Validate mail exists and is eligible for return\n       \
      \ // Update database to mark mail as returned\n        // Send success response\
      \ to client\n    }\n}"
    language: cpp
  notes: This method should only be called when the player has sufficient permissions
    to return the mail item. The underlying mail system must ensure that items can
    only be returned if they haven't been claimed or opened yet. This function is
    part of the core mail handling logic in TrinityCore and directly interacts with
    the database.
  warnings: Improper validation of mail eligibility before returning may lead to data
    inconsistency or security issues. Ensure all checks are performed before modifying
    database records. Also, be aware that this method does not validate if the sender
    has already received the item; it simply marks the return status in the system.
  related:
  - HandleMailGetList
  - HandleMailTakeItem
  - HandleMailTakeMoney
  - HandleMailDelete
metadata:
  confidence: 0.95
  generated_at: '2025-11-04T21:39:50.082573'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
