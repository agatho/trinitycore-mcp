api:
  class: WorldSession
  method: HandleSetTradeCurrencyOpcode
  signature: void WorldSession::HandleSetTradeCurrencyOpcode(WorldPackets::Trade::SetTradeCurrency
    & setTradeCurrency)
documentation:
  brief: Processes the client's request to set the currency for a trade window
  description: Handles the SetTradeCurrency opcode sent by the client when a player
    selects a currency type to use for trading items. This method validates the currency
    selection and updates the trade session state accordingly. The function is part
    of the trade system mechanics in TrinityCore, ensuring that players can specify
    which currency they wish to use during a trade interaction. It typically occurs
    during an active trade session where both parties have initiated the trade process.
  parameters:
  - name: setTradeCurrency
    description: The packet containing the currency ID selected by the player for
      the trade transaction
  returns: null
  examples:
  - title: Basic Usage in Trade Context
    code: "void WorldSession::HandleSetTradeCurrencyOpcode(WorldPackets::Trade::SetTradeCurrency&\
      \ setTradeCurrency)\n{\n    if (!GetPlayer() || !GetPlayer()->GetTrader())\n\
      \        return;\n\n    uint32 currencyId = setTradeCurrency.CurrencyID;\n \
      \   // Validate currency ID against allowed trade currencies\n    if (currencyId\
      \ > 0 && currencyId <= MAX_TRADE_CURRENCY_ID)\n    {\n        GetPlayer()->GetTrader()->SetTradeCurrency(currencyId);\n\
      \    }\n}"
    language: cpp
  notes: This method is part of the trade system and should only be called during
    an active trade session. The currency ID must be validated against the game's
    allowed currencies to prevent exploitation.
  warnings: null
  related:
  - HandleTradeStatus
  - HandleAcceptTradeOpcode
  - HandleCancelTradeOpcode
metadata:
  confidence: 0.9
  generated_at: '2025-11-02T19:12:16.922893'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
