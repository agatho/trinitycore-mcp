api:
  class: Loot
  method: BuildLootResponse
  signature: void Loot::BuildLootResponse(WorldPackets::Loot::LootResponse & packet,
    const Player * viewer) const
documentation:
  brief: Populates a loot response packet with the contents and details of this loot
    object for a specific player viewer.
  description: The BuildLootResponse method constructs a WorldPackets::Loot::LootResponse
    packet by populating it with the relevant loot data from the current Loot object.
    This includes item information, loot properties, and any applicable loot modifiers
    or restrictions based on the viewer's character state. The method is typically
    invoked when a player interacts with a lootable object (such as a corpse or treasure
    chest) to display the available loot items in the client UI. It ensures that only
    appropriate items are shown to the viewer, considering factors like group looting
    rules, individual loot settings, and player permissions within the loot context.
  parameters:
  - name: packet
    description: Reference to a WorldPackets::Loot::LootResponse packet object that
      will be filled with loot data.
  - name: viewer
    description: Pointer to the Player object who is requesting or viewing this loot.
      Determines which items and properties are visible to the viewer based on looting
      rules and permissions.
  returns: void
  examples:
  - title: Basic Usage in Loot Handler
    code: 'Loot* loot = ...; // Assume this is initialized

      Player* player = ...; // Player who opens the loot

      WorldPackets::Loot::LootResponse response;

      loot->BuildLootResponse(response, player);

      player->SendDirectMessage(response);'
    language: cpp
  notes: This method is part of the internal loot system in TrinityCore and should
    not be called directly unless implementing custom loot logic. It respects group
    looting settings, personal loot flags, and item ownership rules. The packet structure
    may vary depending on the version of the game client being used.
  warnings: Ensure that the viewer parameter is valid and not null before calling
    this method to avoid undefined behavior. Incorrectly setting up the packet or
    skipping necessary checks can lead to incorrect loot visibility or client-side
    errors.
  related:
  - Loot::AddItem
  - Loot::ClearLoot
  - Loot::IsLooted
  - Loot::HasItem
metadata:
  confidence: 0.9
  generated_at: '2025-11-06T10:09:56.553182'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
