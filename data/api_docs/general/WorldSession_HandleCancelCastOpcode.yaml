api:
  class: WorldSession
  method: HandleCancelCastOpcode
  signature: void WorldSession::HandleCancelCastOpcode(WorldPackets::Spells::CancelCast
    & packet)
documentation:
  brief: Cancels the currently active spell cast for the player
  description: The HandleCancelCastOpcode method processes incoming client packets
    to cancel an ongoing spell cast. When invoked, it interrupts the current casting
    spell, releasing any resources associated with the cast and sending appropriate
    updates to the client. This method is typically called when a player presses the
    escape key or performs actions that interrupt their spell casting, such as moving
    or switching targets. The method ensures proper cleanup of spell cast state and
    maintains synchronization between server and client spell states.
  parameters: []
  returns: null
  examples:
  - title: Basic usage in packet handling
    code: "void WorldSession::HandleCancelCastOpcode(WorldPackets::Spells::CancelCast&\
      \ packet)\n{\n    if (Player* player = GetPlayer())\n    {\n        player->InterruptSpell(CURRENT_GENERIC_SPELL);\n\
      \    }\n}"
    language: cpp
  notes: This method directly interacts with the player's spell casting state and
    should only be called when a valid player session exists. The implementation relies
    on the TrinityCore spell system to properly interrupt ongoing casts and clean
    up associated resources.
  warnings: Improper handling of this method can lead to inconsistent spell states
    between client and server, potentially causing visual glitches or gameplay issues
    where spells appear to be casting but are actually interrupted without proper
    cleanup.
  related:
  - HandleCastSpellOpcode
  - Player::InterruptSpell
  - Player::HasPendingCast
metadata:
  confidence: 0.95
  generated_at: '2025-11-02T19:43:33.690113'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
