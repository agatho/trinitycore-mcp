api:
  class: ThreatManager
  method: CalculateModifiedThreat
  signature: float ThreatManager::CalculateModifiedThreat(float threat, const Unit
    * victim, const SpellInfo * spell)
documentation:
  brief: Calculates modified threat value based on base threat, victim, and spell
    information for threat management.
  description: The CalculateModifiedThreat method adjusts the base threat value according
    to various factors such as the victim's resistance, spell properties, and combat
    mechanics. It is used internally by the ThreatManager to determine how much threat
    a unit should generate when dealing damage or healing. The modified threat value
    influences aggro behavior and mob targeting decisions in World of Warcraft. This
    method accounts for spell-specific modifiers, target state (such as invulnerability),
    and other game mechanics that affect threat generation.
  parameters:
  - name: threat
    description: The base threat value to be modified. This represents the raw amount
      of threat generated by an action such as dealing damage or healing.
  - name: victim
    description: Pointer to the Unit object that is being attacked or healed. Used
      to determine victim-specific threat modifiers such as resistance or invulnerability
      states.
  - name: spell
    description: Pointer to the SpellInfo structure describing the spell being cast.
      Used to apply spell-specific threat multipliers and modifiers based on spell
      properties.
  returns: Returns the modified threat value as a float. This represents the final
    calculated threat after applying all relevant modifiers and adjustments based
    on the victim and spell information.
  examples:
  - title: Basic Threat Calculation
    code: 'float baseThreat = 100.0f;

      Unit* target = player->GetVictim();

      SpellInfo* spellInfo = sSpellMgr->GetSpellInfo(12345);

      float modifiedThreat = threatManager->CalculateModifiedThreat(baseThreat, target,
      spellInfo);

      // modifiedThreat now contains the adjusted threat value'
    language: cpp
  - title: Using with Damage Dealing
    code: 'float damage = 500.0f;

      Unit* victim = attacker->GetVictim();

      SpellInfo* spellInfo = nullptr; // For melee attacks

      float threat = damage * 0.5f; // Base threat calculation

      float finalThreat = threatManager->CalculateModifiedThreat(threat, victim, spellInfo);

      attacker->AddThreat(victim, finalThreat);'
    language: cpp
  notes: This method is typically called during threat generation events such as damage
    dealt or healing performed. The implementation may vary depending on the specific
    unit type (player vs NPC) and spell properties. It's important to note that this
    function modifies the base threat value rather than directly adding it to the
    threat list.
  warnings: Do not call this method with null pointers for victim or spell parameters
    as it may lead to undefined behavior. The threat value should always be a positive
    number, though negative values might be handled internally by the system.
  related:
  - AddThreat
  - GetThreat
  - UpdateThreat
metadata:
  confidence: 0.9
  generated_at: '2025-11-01T05:26:42.210876'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
