api:
  class: DoubleBufferedSpatialGrid
  method: QueryNearbyPlayers
  signature: int DoubleBufferedSpatialGrid::QueryNearbyPlayers(const int & pos, float
    radius) const
documentation:
  brief: Queries and returns the number of nearby players within a specified radius
    from a given position in the spatial grid.
  description: The QueryNearbyPlayers method performs a spatial query to count how
    many players are located within a given radius from a specified position. This
    method is typically used in World of Warcraft's TrinityCore server implementation
    for efficient player detection and interaction handling. It leverages the double-buffered
    spatial grid structure to quickly identify nearby entities without iterating through
    all players in the world. The method takes a position (likely represented as an
    index or coordinate) and a radius value, then returns the count of players found
    within that area. This functionality is essential for game mechanics such as area-of-effect
    spells, player visibility checks, and proximity-based interactions.
  parameters:
  - name: pos
    description: The position identifier or index in the spatial grid from which to
      query nearby players. This parameter likely represents a grid cell or coordinate
      within the double-buffered spatial structure.
  - name: radius
    description: The radius (in game units) around the specified position to search
      for nearby players. Must be a positive floating-point value representing the
      detection range.
  returns: Returns an integer representing the number of players found within the
    specified radius from the given position. A return value of zero indicates no
    players were detected in the area.
  examples:
  - title: Basic usage to count nearby players
    code: "int playerCount = grid.QueryNearbyPlayers(1234, 50.0f); // Query for players\
      \ within 50 units of position 1234\nif (playerCount > 0) {\n    printf(\"Found\
      \ %d players nearby\\n\", playerCount);\n}"
    language: cpp
  - title: Using query result to trigger area effect
    code: "const int playerPosition = GetPlayerGridPosition(player);\nconst float\
      \ detectionRadius = 30.0f;\nint nearbyPlayers = grid.QueryNearbyPlayers(playerPosition,\
      \ detectionRadius);\nif (nearbyPlayers > 0) {\n    // Apply area effect spell\
      \ to all nearby players\n    ApplyAreaEffectSpell(player, nearbyPlayers);\n}"
    language: cpp
  notes: This method is optimized for performance using a double-buffered spatial
    grid structure. It avoids full iteration over all players and instead uses spatial
    partitioning techniques. The 'pos' parameter should be a valid index within the
    grid bounds, otherwise behavior is undefined. The radius value must be positive;
    negative values may produce unexpected results.
  warnings: Ensure that the position parameter corresponds to a valid grid cell or
    coordinate in the spatial structure. Passing invalid positions can lead to memory
    access violations or incorrect counts. This method does not perform any bounds
    checking on the radius, so extremely large values might impact performance.
  related:
  - QueryNearbyUnits
  - QueryNearbyObjects
  - GetPlayerCountInRadius
  - UpdateSpatialGrid
metadata:
  confidence: 0.85
  generated_at: '2025-11-06T15:32:44.588981'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
