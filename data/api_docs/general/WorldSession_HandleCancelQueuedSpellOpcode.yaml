api:
  class: WorldSession
  method: HandleCancelQueuedSpellOpcode
  signature: void WorldSession::HandleCancelQueuedSpellOpcode(WorldPackets::Spells::CancelQueuedSpell
    & cancelQueuedSpell)
documentation:
  brief: Cancels a queued spell that is currently in the casting queue.
  description: The HandleCancelQueuedSpellOpcode method processes incoming client
    packets to cancel a spell that has been queued but not yet cast. This typically
    occurs when a player cancels a spell before it completes its casting time, such
    as when they switch to a different spell or move away from the target. The method
    validates the spell queue and removes the specified spell from the casting queue
    if it exists. It is part of the core spell handling system in TrinityCore's WorldSession
    class.
  parameters:
  - name: cancelQueuedSpell
    description: A reference to a WorldPackets::Spells::CancelQueuedSpell packet containing
      the spell ID to be canceled from the queue.
  returns: null
  examples:
  - title: Basic Usage Example
    code: "void WorldSession::HandleCancelQueuedSpellOpcode(WorldPackets::Spells::CancelQueuedSpell\
      \ & cancelQueuedSpell)\n{\n    if (Player* player = GetPlayer())\n    {\n  \
      \      // Cancel the queued spell\n        player->CancelSpellQueue(cancelQueuedSpell.SpellID);\n\
      \    }\n}"
    language: cpp
  notes: This method is typically called in response to client-side UI actions like
    pressing Escape or selecting another spell. The spell ID provided must correspond
    to a valid queued spell; otherwise, the operation will have no effect.
  warnings: null
  related:
  - HandleCastSpellOpcode
  - HandleCancelSpell
  - Player::CancelSpellQueue
metadata:
  confidence: 0.9
  generated_at: '2025-11-02T19:41:44.227524'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
