api:
  class: VisibleItem
  method: WriteUpdate
  signature: void VisibleItem::WriteUpdate(ByteBuffer & data, bool ignoreChangesMask,
    const Unit * owner, const Player * receiver) const
documentation:
  brief: Serializes visible item data into a ByteBuffer for network transmission to
    a specific player.
  description: The WriteUpdate method serializes the state of a VisibleItem object
    into a ByteBuffer, which is typically used for sending updates about an item's
    appearance or properties to a client. This method is commonly invoked when an
    item needs to be sent to a player, such as during login, when equipping items,
    or when updating visual properties of items in the game world. The serialization
    process considers whether changes have occurred and can optionally ignore the
    change mask if needed. It also takes into account the owner of the item and the
    receiving player to ensure proper data filtering and visibility rules are applied.
  parameters:
  - name: data
    description: A reference to a ByteBuffer object where the serialized update data
      will be written. This buffer is typically used for constructing network packets
      sent to the client.
  - name: ignoreChangesMask
    description: A boolean flag indicating whether to ignore the internal changes
      mask when serializing the item data. If true, all fields are included regardless
      of their change status.
  - name: owner
    description: A pointer to the Unit that owns this visible item. This is used to
      determine ownership context and access rights during serialization.
  - name: receiver
    description: A pointer to the Player who will receive this update. Used for filtering
      data based on visibility rules and player-specific conditions.
  returns: null
  examples:
  - title: Basic Usage Example
    code: 'ByteBuffer updateData;

      VisibleItem* item = ...; // Assume we have a visible item

      Player* receiver = ...; // Player who will receive the update

      Unit* owner = ...; // Owner of the item

      item->WriteUpdate(updateData, false, owner, receiver);'
    language: cpp
  - title: Ignoring Changes Mask Example
    code: 'ByteBuffer updateData;

      VisibleItem* item = ...;

      Player* receiver = ...;

      Unit* owner = ...;

      // Force sending all data regardless of changes

      item->WriteUpdate(updateData, true, owner, receiver);'
    language: cpp
  notes: This method is part of the TrinityCore's packet update system and should
    only be called when preparing updates for network transmission. The method assumes
    that all necessary checks regarding item visibility and ownership have already
    been performed before calling.
  warnings: Calling this method without proper initialization of the ByteBuffer or
    invalid pointers can lead to undefined behavior. Ensure the receiver parameter
    is valid and the owner is properly set before invoking this method.
  related:
  - VisibleItem::BuildValuesUpdate
  - VisibleItem::GetEntry
  - VisibleItem::SetEntry
metadata:
  confidence: 0.9
  generated_at: '2025-11-07T17:28:48.604114'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
