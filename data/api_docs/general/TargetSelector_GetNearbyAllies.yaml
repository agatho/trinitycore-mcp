api:
  class: TargetSelector
  method: GetNearbyAllies
  signature: int TargetSelector::GetNearbyAllies(float range) const
documentation:
  brief: Counts and returns the number of nearby friendly units within the specified
    range.
  description: The GetNearbyAllies method scans the environment around the current
    unit to identify and count all allied creatures or players that are within a given
    range. This method is typically used in AI decision-making processes to determine
    the presence of support units for tactical actions such as grouping, healing,
    or coordination. The range parameter defines the maximum distance (in yards) from
    the unit's position to consider allies. The method performs a spatial query using
    the TrinityCore's collision detection system and returns an integer representing
    the total count of valid nearby allies. It does not distinguish between different
    types of allies (e.g., players vs. NPCs), but rather counts all units that are
    considered 'allied' according to the game's faction system.
  parameters: []
  returns: Returns an integer value representing the number of friendly units found
    within the specified range. A return value of zero indicates no allied units were
    detected in the area. Negative values should not occur under normal circumstances,
    though they may indicate an internal error or invalid state if encountered.
  examples:
  - title: Basic Usage to Determine Nearby Allies
    code: "int allies = unit->GetNearbyAllies(10.0f);\nif (allies > 0)\n{\n    //\
      \ Proceed with group-based action\n    unit->CastSpell(target, SPELL_GROUP_HEAL,\
      \ true);\n}"
    language: cpp
  - title: Using Nearby Allies Count for Tactical Decision Making
    code: "int nearbyAllies = unit->GetNearbyAllies(25.0f);\nif (nearbyAllies >= 3)\n\
      {\n    // Execute a powerful AoE spell\n    unit->CastSpell(nullptr, SPELL_BLADE_STORM,\
      \ true);\n}\nelse if (nearbyAllies >= 1)\n{\n    // Use a single-target ability\n\
      \    unit->CastSpell(target, SPELL_MORTAL_STRIKE, true);\n}"
    language: cpp
  notes: This method uses the TrinityCore's internal spatial indexing system to efficiently
    query nearby units. It is optimized for performance in AI routines but may be
    affected by map loading states or unit visibility. The range parameter is interpreted
    as a spherical radius from the unit's center, not including height differences.
    This method does not account for line of sight restrictions; it only considers
    proximity.
  warnings: Be cautious when using large range values as this can lead to performance
    degradation in densely populated areas or during high-frequency AI updates. The
    method assumes that the calling unit is valid and properly initialized. Using
    this method on a destroyed or invalid unit may result in undefined behavior.
  related:
  - GetNearbyEnemies
  - GetNearbyUnits
  - GetDistance
metadata:
  confidence: 0.9
  generated_at: '2025-11-07T09:22:19.560158'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
