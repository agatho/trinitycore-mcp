api:
  class: MageAI
  method: GetOptimalPosition
  signature: int MageAI::GetOptimalPosition(::Unit * target)
documentation:
  brief: Calculates and returns the optimal position for a Mage AI to cast spells
    based on target distance and spell requirements.
  description: The GetOptimalPosition method determines the best location for a Mage
    AI unit to stand when casting spells, considering factors such as spell range,
    line of sight, and target positioning. This method is typically used by the Mage's
    AI behavior system to optimize spellcasting effectiveness. It evaluates the current
    position relative to the target unit and returns an integer value representing
    the calculated optimal position index or status code. The method may consider
    various spell-specific constraints like maximum range, minimum distance, and whether
    the target is within line of sight.
  parameters:
  - name: target
    description: Pointer to the Unit object representing the target enemy or ally
      for spell casting. Must not be null for valid operation.
  returns: Returns an integer value indicating the optimal position index or status
    code. Positive values typically represent valid positions, while negative values
    may indicate errors or invalid conditions such as unreachable targets or insufficient
    range.
  examples:
  - title: Basic usage in Mage AI context
    code: "int optimalPos = mageAI->GetOptimalPosition(targetUnit);\nif (optimalPos\
      \ >= 0) {\n    // Proceed with spell casting at calculated position\n    mageAI->CastSpellAtPosition(optimalPos);\n\
      } else {\n    // Handle error case - cannot determine optimal position\n   \
      \ LOG_ERROR(\"ai\", \"Failed to calculate optimal position for Mage AI\");\n\
      }"
    language: cpp
  - title: Integration with spell casting logic
    code: "void MageAI::ExecuteSpellCast(Unit* target) {\n    int pos = GetOptimalPosition(target);\n\
      \    if (pos >= 0 && IsSpellInRange(target)) {\n        // Move to optimal position\
      \ before casting\n        MoveToPosition(pos);\n        CastCurrentSpell(target);\n\
      \    } else if (pos == -1) {\n        // Target out of range\n        SetNextAction(AI_ACTION_MOVE_TO_TARGET);\n\
      \    }\n}"
    language: cpp
  notes: This method is part of the Mage AI subsystem and relies on internal spell
    data and positioning calculations. The returned integer value should be interpreted
    according to the AI's internal position mapping system. Performance may vary depending
    on target distance, terrain complexity, and spell requirements.
  warnings: Ensure that the target parameter is valid and not null before calling
    this method. Calling with an invalid or destroyed unit pointer can cause undefined
    behavior. The method may return negative values indicating failure conditions
    that should be handled appropriately.
  related:
  - GetSpellRange
  - IsSpellInRange
  - MoveToPosition
  - CastSpellAtPosition
metadata:
  confidence: 0.85
  generated_at: '2025-11-07T01:47:20.809324'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
