api:
  class: FormationManager
  method: AdjustMovementForFormation
  signature: int FormationManager::AdjustMovementForFormation(const int & intendedPos)
documentation:
  brief: Adjusts the movement position of a unit based on its formation configuration.
  description: The AdjustMovementForFormation method calculates and returns the adjusted
    movement position for a unit within a formation. It takes into account the intended
    position within the formation and applies necessary adjustments to maintain proper
    formation spacing and alignment. This method is typically used during AI movement
    calculations to ensure units stay in their designated formation positions while
    moving through the world. The method may modify the intended position based on
    formation rules, unit size, and surrounding unit positions.
  parameters:
  - name: intendedPos
    description: The intended position index within the formation that this unit should
      occupy. This value represents the unit's desired location in the formation structure,
      typically ranging from 0 to N-1 where N is the total number of units in the
      formation.
  returns: Returns an integer representing the adjusted position index that the unit
    should actually move to within the formation. A positive value indicates a valid
    adjusted position, while negative values may indicate errors or special conditions
    such as invalid formation data.
  examples:
  - title: Basic usage in formation movement
    code: "int adjustedPosition = formationManager->AdjustMovementForFormation(2);\n\
      if (adjustedPosition >= 0)\n{\n    // Proceed with movement to adjusted position\n\
      \    unit->MoveTo(adjustedPosition);\n}\nelse\n{\n    // Handle error case -\
      \ invalid formation data or calculation failure\n    LOG_ERROR(\"world\", \"\
      Failed to calculate adjusted formation position\");\n}"
    language: cpp
  - title: Integration with AI movement logic
    code: "class FormationAI\n{\npublic:\n    void UpdateMovement()\n    {\n     \
      \   int intendedPos = GetUnitFormationPosition();\n        int adjustedPos =\
      \ formationManager->AdjustMovementForFormation(intendedPos);\n        \n   \
      \     if (adjustedPos >= 0 && adjustedPos != intendedPos)\n        {\n     \
      \       // Apply formation adjustment to movement\n            MoveToAdjustedPosition(adjustedPos);\n\
      \        }\n        else if (adjustedPos < 0)\n        {\n            // Fallback\
      \ to default movement behavior\n            MoveToDefaultPosition();\n     \
      \   }\n    }\n};"
    language: cpp
  notes: This method is part of the formation management system and should only be
    called when a unit is actively participating in a formation. The adjustment calculation
    may involve complex spatial mathematics to maintain proper spacing between units.
    Performance considerations include avoiding frequent calls during high-frequency
    movement updates, as this method may perform calculations involving multiple unit
    positions.
  warnings: This method assumes that the FormationManager has valid formation data
    and that the intendedPos parameter is within acceptable bounds for the current
    formation. Calling with invalid position indices may result in undefined behavior
    or incorrect positioning. The method may return negative values indicating failure
    conditions, so callers should always validate the return value before using it.
  related:
  - GetFormationPosition
  - SetFormationPosition
  - ValidateFormation
  - CalculateFormationSpacing
metadata:
  confidence: 0.85
  generated_at: '2025-11-02T07:39:33.506667'
  generator: lmstudio-qwen3-coder-30b
  version: 1.0.0
  source: core
